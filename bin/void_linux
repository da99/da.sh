#!/usr/bin/env zsh
#
#
set -u -e -o pipefail

case "$@" in
  -h|--help|help)
    cmd="$(basename "$0")"
    echo "  $cmd hud available packages"
    echo "  $cmd upgrade packages"
    echo "  $cmd install time"
    echo "       Installs and activates the openntpd service"
    ;;

  "install time")
    if ! test -e /var/service/openntpd ; then
      set -x
      sudo xbps-install -S openntpd
      sudo ln -s /etc/sv/openntpd /var/service/
      set +X
    fi
    ;;

  "upgrade packages")
    set -x
    sudo xbps-install -Su
    sudo xbps-remove -Oo
    "$0" install time
    set +x
    if test -e /progs/void-packages ; then
      cd /progs/void-packages
      git pull
      xcheckmypkgs
    fi
    ;;

  "hud available packages")
    count="$(xbps-install -Mun | wc -l)"
    if test "$count" = "0" ; then
      echo
    else
      echo "New packages: $count"
    fi
    ;;

  *)
    echo "!!! Unknown options: $@" >&2
    exit 1
    ;;
esac

