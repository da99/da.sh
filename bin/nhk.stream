#!/bin/env zsh

set -u -e -x
PORT=2112

for x in streamlink curl ; do
  which "$x" || {
    echo "!!! $x not installed." >&2
    exit 1
  }
done

count=0
while test "$count" -lt 60 && ! ping -W 3 -c 1 8.8.8.8 ; do
  sleep 5
  echo -n "."
  count=$(( count + 1 ))
done

echo "=== Starting at $(date):"
set -x
exec streamlink           \
  --http-no-ssl-verify    \
  --player-external-http  \
  --player-external-http-port $PORT \
  --default-stream best   \
  nhk.or.jp/nhkworld  best


